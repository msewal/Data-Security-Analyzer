{% extends 'list/base.html' %}
{% load static %}

{% block title %}Regex Detay - {{ file_path }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Ana Sayfa</a></li>
            <li class="breadcrumb-item"><a href="{% url 'regex_search' %}">Regex Arama</a></li>
            <li class="breadcrumb-item"><a href="{% url 'regex_search_results' %}">Sonuçlar</a></li>
            <li class="breadcrumb-item active">Detay</li>
        </ol>
    </nav>

    <div class="card mb-4">
        <div class="card-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-file-earmark"></i> Dosya Detayları
                    </h5>
                </div>
                <div class="col-md-4 text-end">
                    <div class="btn-group">
                        <a href="{% url 'regex:view_file' file_path %}" class="btn btn-info" title="Dosyayı Görüntüle">
                            <i class="bi bi-eye"></i> Görüntüle
                        </a>
                        <a href="{% url 'regex:edit_file' file_path %}" class="btn btn-warning" title="Dosyayı Düzenle">
                            <i class="bi bi-pencil"></i> Düzenle
                        </a>
                        <button type="button" class="btn btn-danger" onclick="quarantineFile('{{ file_path }}')" title="Karantinaya Al">
                            <i class="bi bi-shield-lock"></i> Karantina
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="row mb-4">
                <div class="col-md-6">
                    <h6 class="mb-3">Dosya Bilgileri</h6>
                    <table class="table table-sm">
                        <tr>
                            <th style="width: 150px;">Dosya Yolu:</th>
                            <td>{{ file_path }}</td>
                        </tr>
                        <tr>
                            <th>Dosya Türü:</th>
                            <td>{{ file_type|upper }}</td>
                        </tr>
                        <tr>
                            <th>Dosya Boyutu:</th>
                            <td>{{ file_size|filesizeformat }}</td>
                        </tr>
                        <tr>
                            <th>Eşleşme Sayısı:</th>
                            <td><span class="badge bg-primary">{{ matches_count }}</span></td>
                        </tr>
                    </table>
                </div>
                <div class="col-md-6">
                    <h6 class="mb-3">Regex Pattern</h6>
                    <div class="alert alert-info">
                        <code>{{ pattern }}</code>
                    </div>
                </div>
            </div>

            {% if matches %}
            <h6 class="mb-3">Eşleşmeler</h6>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th style="width: 80px;">Satır</th>
                            <th>Eşleşme</th>
                            <th>Bağlam</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for match in matches %}
                        <tr>
                            <td>
                                <span class="badge bg-secondary">{{ match.line }}</span>
                            </td>
                            <td>
                                <code>{{ match.match }}</code>
                            </td>
                            <td>
                                <pre class="mb-0"><code>{{ match.context }}</code></pre>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-warning">
                <i class="bi bi-exclamation-triangle"></i> Bu dosyada eşleşme bulunamadı.
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function quarantineFile(filePath) {
    if (confirm('Bu dosyayı karantinaya almak istediğinizden emin misiniz?')) {
        window.location.href = `/regex/quarantine/${encodeURIComponent(filePath)}/`;
    }
}
</script>

<style>
.table td {
    vertical-align: middle;
}
.btn-group {
    gap: 0.25rem;
}
.badge {
    font-size: 0.9em;
}
pre {
    background-color: #f8f9fa;
    padding: 0.5rem;
    border-radius: 0.25rem;
    margin: 0;
    white-space: pre-wrap;
}
code {
    color: #d63384;
    background-color: #f8f9fa;
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
}
</style>
{% endblock %}
